vibe coding 就是爽

## 一个常见的HTTP请求报文

```http
GET /index.html HTTP/1.1\r\n
Host: www.example.com\r\n
Connection: keep-alive\r\n
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64)\r\n
Accept: text/html,application/xhtml+xml\r\n
\r\n
```
第一行是请求行  
中间为请求头: 字段名:[空白字符] 值\r\n

## 一个常见的响应报文

```http
HTTP/1.1 200 OK\r\n
Content-Length: 156\r\n
Connection: keep-alive\r\n
Content-Type: text/html\r\n
\r\n
<html>
  <head><title>Example</title></head>
  <body>Hello, World!</body>
</html>
```

第一行是状态行
下面的是响应头
空行然后是响应体

GET：请求数据附在 URL 中，以?分隔 URL 和参数，多个参数用&连接。
示例：GET /search?keyword=test&page=1 HTTP/1.1。
特点：数据可见，保存在浏览器历史和服务器日志中。
POST：请求数据放在请求体（Body）中，不在 URL 中显示。
示例：请求头中通过Content-Length指定数据长度，请求体包含实际数据（如username=xxx&password=xxx）。
你的代码中parse_content函数用于解析请求体，但因不支持 POST，该逻辑实际未被有效使用。

## 项目问题排查与解决

### 1. URL查询参数处理问题

**问题描述**：
服务器无法正确处理带有查询参数的URL请求。当浏览器发送形如`/?id=xxx&vscodeBrowserReqId=xxx`的请求时，服务器尝试在文件系统中查找包含这些查询参数的文件，导致返回404错误。

**原因分析**：
1. HTTP的GET请求中，URL可以包含查询参数，格式为`/path?param1=value1&param2=value2`
2. 在服务器处理URL时，需要将路径部分和查询参数部分分开
3. 服务器只应使用路径部分(`/path`)来查找文件，忽略查询参数部分

**解决方法**：
修改`do_request`函数，分离URL中的路径和查询参数：
```cpp
// 处理URL，移除查询参数（问号后面的部分）
char url_path[FILENAME_LEN] = {0};
strcpy(url_path, m_url);
// 找到第一个?，并在那里截断URL
char* query_start = strchr(url_path, '?');
if (query_start) {
    *query_start = '\0';
}
```

### 2. 路径处理问题

**问题描述**：
当请求目录时，服务器在添加默认文件时可能会产生双斜杠，例如`/path//index.html`，导致文件路径错误。

**解决方法**：
在添加默认文件前检查路径末尾是否已有斜杠：
```cpp
// 检查路径末尾是否已有斜杠
int path_len = strlen(m_real_file);
if (path_len > 0 && m_real_file[path_len-1] != '/') {
    strcat(m_real_file, "/");
}
strcat(m_real_file, "index.html");
```

### 3. HTTP响应问题

**问题描述**：
在`process_write`函数中，处理`FILE_REQUEST`时有一个逻辑错误，导致`m_iv_count`没有被正确设置，从而无法正确发送文件内容。

**原因分析**：
原代码在添加完头部后直接返回了`true`，跳过了设置`m_iv`数组的代码：
```cpp
if (m_file_stat.st_size) {
    add_headers(m_file_stat.st_size);
    return true; // 这里直接返回，导致没有设置m_iv
}
```

**解决方法**：
修改`process_write`函数，移除提前返回，确保`m_iv`和`m_iv_count`能够正确设置：
```cpp
if (m_file_stat.st_size) {
    add_headers(m_file_stat.st_size);
    // 不要在这里直接返回，让下面的代码设置m_iv和m_iv_count
}
```

希望之后实现一个可以POST的
线程池用固定数量的8个线程 没有根据负载动态增加线程 没有根据空闲时间减少线程 没有线程存活时间的概念
